# Service Mesh & Observability Implementation Guide

## Overview

This document outlines the complete implementation of **Istio Service Mesh** and **Observability Stack** for the Restaurant Management System, including integration with the existing GitHub Actions CI/CD pipeline and Helm deployment strategy.

---

## Table of Contents

1. [Architecture Overview](#architecture-overview)
2. [Istio Service Mesh](#istio-service-mesh)
3. [Kiali Dashboard](#kiali-dashboard)
4. [Observability Stack](#observability-stack)
5. [GitHub Actions Integration](#github-actions-integration)
6. [Helm Chart Structure](#helm-chart-structure)
7. [Installation Steps](#installation-steps)
8. [Configuration Details](#configuration-details)
9. [Monitoring & Alerting](#monitoring--alerting)
10. [Cost Analysis](#cost-analysis)

---

## Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         INTERNET / USERS                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   CloudFlare WAF/CDN       â”‚
                    â”‚   (DDoS Protection)        â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      KUBERNETES CLUSTER                                  â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ISTIO CONTROL PLANE                           â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚   â”‚
â”‚  â”‚  â”‚ istiod   â”‚  â”‚ Pilot    â”‚  â”‚ Citadel  â”‚  â”‚ Galley   â”‚       â”‚   â”‚
â”‚  â”‚  â”‚ (1 pod)  â”‚  â”‚(merged)  â”‚  â”‚(merged)  â”‚  â”‚(merged)  â”‚       â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                    ISTIO INGRESS GATEWAY                         â”‚   â”‚
â”‚  â”‚              (LoadBalancer - 2 replicas)                         â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚   â”‚
â”‚  â”‚  â”‚   istio-ingressgw-1  â”‚  â”‚   istio-ingressgw-2  â”‚            â”‚   â”‚
â”‚  â”‚  â”‚   (Envoy Proxy)      â”‚  â”‚   (Envoy Proxy)      â”‚            â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   APPLICATION NAMESPACE                          â”‚   â”‚
â”‚  â”‚                  (restaurant-management)                         â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚   â”‚
â”‚  â”‚  â”‚  API Gateway Service (2 pods)                            â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  api-gateway-1   â”‚  â”‚  api-gateway-2   â”‚             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  + Envoy Sidecar â”‚  â”‚  + Envoy Sidecar â”‚             â”‚   â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚   â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Order Service (2 pods)                                   â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  order-service-1 â”‚  â”‚  order-service-2 â”‚              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  + Envoy Sidecar â”‚  â”‚  + Envoy Sidecar â”‚              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Restaurant Service (2 pods)                              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Menu Service (2 pods)                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Auth Service (2 pods)                                    â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  Notification Service (2 pods)                            â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  (All with Envoy Sidecars)                                â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚   â”‚
â”‚  â”‚  â”‚  Frontend (2 pods)                                        â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  frontend-1      â”‚  â”‚  frontend-2      â”‚              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â”‚  + Envoy Sidecar â”‚  â”‚  + Envoy Sidecar â”‚              â”‚  â”‚   â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚  â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   OBSERVABILITY NAMESPACE                        â”‚   â”‚
â”‚  â”‚                     (istio-system)                               â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚  Prometheus  â”‚  â”‚   Grafana    â”‚  â”‚    Kiali     â”‚          â”‚   â”‚
â”‚  â”‚  â”‚   (1 pod)    â”‚  â”‚   (1 pod)    â”‚  â”‚   (1 pod)    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚   Metrics    â”‚  â”‚ Dashboards   â”‚  â”‚ Service Mesh â”‚          â”‚   â”‚
â”‚  â”‚  â”‚              â”‚  â”‚              â”‚  â”‚  Topology    â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â”‚         â”‚                  â”‚                  â”‚                  â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”        â”‚   â”‚
â”‚  â”‚  â”‚           Metrics Collection & Storage              â”‚        â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚   â”‚
â”‚  â”‚                                                                   â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚    Loki      â”‚  â”‚   Promtail   â”‚  â”‚    Jaeger    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚   (1 pod)    â”‚  â”‚  (DaemonSet) â”‚  â”‚   (1 pod)    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚   Logs       â”‚  â”‚  Log Agent   â”‚  â”‚   Traces     â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                   DATABASE NAMESPACE                             â”‚   â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚
â”‚  â”‚  â”‚  PostgreSQL  â”‚  â”‚    Redis     â”‚  â”‚   RabbitMQ   â”‚          â”‚   â”‚
â”‚  â”‚  â”‚   (3 pods)   â”‚  â”‚   (1 pod)    â”‚  â”‚   (1 pod)    â”‚          â”‚   â”‚
â”‚  â”‚  â”‚  (No Sidecar)â”‚  â”‚ (No Sidecar) â”‚  â”‚ (No Sidecar) â”‚          â”‚   â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                           DATA FLOW
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                           â”‚
â”‚  Request â†’ CloudFlare â†’ Istio Ingress â†’ Envoy (Sidecar) â†’ Service      â”‚
â”‚                                â”‚                â”‚                        â”‚
â”‚                         [Metrics Collected]  [Traces]                    â”‚
â”‚                                â”‚                â”‚                        â”‚
â”‚                         Prometheus â†â”€â”€â”€â”€â”€â”€â”€â†’ Jaeger                     â”‚
â”‚                                â”‚                                          â”‚
â”‚                         Grafana Dashboards                               â”‚
â”‚                         Kiali Topology                                   â”‚
â”‚                                                                           â”‚
â”‚  Logs â†’ Promtail â†’ Loki â†’ Grafana                                       â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Istio Service Mesh

### What is Istio?

Istio is a **service mesh** that provides:
- **Traffic Management**: Load balancing, circuit breaking, retries, timeouts
- **Security**: mTLS encryption, authentication, authorization
- **Observability**: Metrics, logs, traces
- **Policy Enforcement**: Rate limiting, access control

### Istio Components

#### 1. **Control Plane (istiod)**
- **Single unified component** (merged Pilot, Citadel, Galley)
- Manages configuration and certificate distribution
- Handles service discovery
- Configures Envoy proxies
- **Resources**: 1 pod (HA mode: 2 pods)

#### 2. **Data Plane (Envoy Sidecars)**
- **Envoy proxy** injected into each application pod
- Intercepts all network traffic
- Enforces policies and collects telemetry
- **Resources**: 1 sidecar per application pod

#### 3. **Ingress Gateway**
- **Edge proxy** for external traffic
- Replaces traditional Nginx Ingress
- **Resources**: 2 pods (HA)

#### 4. **Egress Gateway** (Optional)
- Controls outbound traffic
- Not needed for initial deployment
- **Resources**: 0 pods (skipped)

### Istio Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ISTIO CONTROL PLANE                     â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                      istiod                             â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚ â”‚
â”‚  â”‚  â”‚  Pilot   â”‚  â”‚ Citadel  â”‚  â”‚  Galley  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚          â”‚  â”‚          â”‚  â”‚          â”‚             â”‚ â”‚
â”‚  â”‚  â”‚ Service  â”‚  â”‚ Identity â”‚  â”‚  Config  â”‚             â”‚ â”‚
â”‚  â”‚  â”‚Discovery â”‚  â”‚   & CA   â”‚  â”‚Validationâ”‚             â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜             â”‚ â”‚
â”‚  â”‚       â”‚             â”‚             â”‚                     â”‚ â”‚
â”‚  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                     â”‚ â”‚
â”‚  â”‚                     â”‚                                    â”‚ â”‚
â”‚  â”‚              Configuration Push                          â”‚ â”‚
â”‚  â”‚                     â”‚                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                        â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚               â”‚               â”‚
         â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Pod A     â”‚  â”‚   Pod B     â”‚  â”‚   Pod C     â”‚
â”‚             â”‚  â”‚             â”‚  â”‚             â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚  App    â”‚ â”‚  â”‚ â”‚  App    â”‚ â”‚  â”‚ â”‚  App    â”‚ â”‚
â”‚ â”‚Containerâ”‚ â”‚  â”‚ â”‚Containerâ”‚ â”‚  â”‚ â”‚Containerâ”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚      â”‚      â”‚  â”‚      â”‚      â”‚  â”‚      â”‚      â”‚
â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚  â”‚ â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Envoy   â”‚â—„â”¼â”€â”€â”¼â–ºâ”‚ Envoy   â”‚â—„â”¼â”€â”€â”¼â–ºâ”‚ Envoy   â”‚ â”‚
â”‚ â”‚ Sidecar â”‚ â”‚  â”‚ â”‚ Sidecar â”‚ â”‚  â”‚ â”‚ Sidecar â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚  â”‚ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚      â”‚      â”‚  â”‚      â”‚      â”‚  â”‚      â”‚      â”‚
â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”˜
       â”‚                â”‚                â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                  mTLS Encrypted
                 Traffic (automatic)
```

### Key Features

1. **Automatic Sidecar Injection**
   - Label namespace: `istio-injection=enabled`
   - Istio automatically injects Envoy proxy into pods

2. **Mutual TLS (mTLS)**
   - Automatic encryption between services
   - No code changes required
   - Certificate rotation handled automatically

3. **Traffic Management**
   - Canary deployments
   - A/B testing
   - Blue-green deployments
   - Traffic splitting

4. **Observability**
   - Automatic metrics collection (RED metrics)
   - Distributed tracing
   - Service topology visualization

---

## Kiali Dashboard

### What is Kiali?

Kiali is the **management console** for Istio service mesh, providing:
- **Service Topology Visualization**: Real-time graph of services
- **Traffic Flow Analysis**: Request rates, error rates, latencies
- **Configuration Validation**: Istio configuration errors
- **Distributed Tracing**: Integration with Jaeger
- **Metrics Visualization**: Integration with Prometheus/Grafana

### Kiali Features

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       KIALI DASHBOARD                            â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Service Graph View                        â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚     Frontend â”€â”€â”€â”€â”€â”€â”                                       â”‚  â”‚
â”‚  â”‚         â”‚          â”‚                                       â”‚  â”‚
â”‚  â”‚         â–¼          â–¼                                       â”‚  â”‚
â”‚  â”‚    API Gateway â”€â”€â”€â”€â”€â”€â”€â–º Order Service                     â”‚  â”‚
â”‚  â”‚         â”‚                    â”‚                             â”‚  â”‚
â”‚  â”‚         â”œâ”€â”€â”€â”€â–º Restaurant    â”‚                             â”‚  â”‚
â”‚  â”‚         â”‚         Service    â”‚                             â”‚  â”‚
â”‚  â”‚         â”‚            â”‚       â”‚                             â”‚  â”‚
â”‚  â”‚         â”œâ”€â”€â”€â”€â–º Menu  â”‚       â”‚                             â”‚  â”‚
â”‚  â”‚         â”‚      Service       â”‚                             â”‚  â”‚
â”‚  â”‚         â”‚            â”‚       â”‚                             â”‚  â”‚
â”‚  â”‚         â””â”€â”€â”€â”€â–º Auth  â”‚       â”‚                             â”‚  â”‚
â”‚  â”‚               Service        â”‚                             â”‚  â”‚
â”‚  â”‚                  â”‚           â”‚                             â”‚  â”‚
â”‚  â”‚                  â–¼           â–¼                             â”‚  â”‚
â”‚  â”‚              PostgreSQL    Redis                          â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  ğŸŸ¢ Healthy  ğŸŸ¡ Degraded  ğŸ”´ Failed  ğŸ“Š Traffic Flow      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Traffic Metrics                           â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  Service          RPS    Error %   P50    P95    P99      â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚
â”‚  â”‚  api-gateway      250    0.05%    15ms   45ms   120ms    â”‚  â”‚
â”‚  â”‚  order-service    180    0.10%    22ms   65ms   180ms    â”‚  â”‚
â”‚  â”‚  restaurant-svc   120    0.02%    12ms   35ms   95ms     â”‚  â”‚
â”‚  â”‚  menu-service     200    0.01%    8ms    25ms   70ms     â”‚  â”‚
â”‚  â”‚  auth-service     80     0.50%    18ms   55ms   150ms    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Configuration Validation                      â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  âœ… All VirtualServices valid                              â”‚  â”‚
â”‚  â”‚  âœ… All DestinationRules valid                             â”‚  â”‚
â”‚  â”‚  âš ï¸  Warning: mTLS PERMISSIVE mode enabled                â”‚  â”‚
â”‚  â”‚  âœ… All Gateways configured correctly                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                Distributed Traces                          â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  Trace: Order Placement Flow                              â”‚  â”‚
â”‚  â”‚  â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”  â”‚  â”‚
â”‚  â”‚  frontend (85ms)                                           â”‚  â”‚
â”‚  â”‚    â””â”€â–º api-gateway (15ms)                                 â”‚  â”‚
â”‚  â”‚         â””â”€â–º order-service (42ms)                          â”‚  â”‚
â”‚  â”‚              â”œâ”€â–º restaurant-service (8ms)                 â”‚  â”‚
â”‚  â”‚              â”œâ”€â–º menu-service (12ms)                      â”‚  â”‚
â”‚  â”‚              â””â”€â–º postgresql (18ms)                        â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  Total Duration: 180ms                                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Kiali Components

- **1 Pod**: Kiali server
- **Web UI**: Accessible via LoadBalancer or port-forward
- **Integration**: Prometheus, Jaeger, Grafana

---

## Observability Stack

### 1. Prometheus (Metrics)

**Purpose**: Time-series metrics database

**What it collects**:
- Request rate (requests per second)
- Error rate (4xx, 5xx responses)
- Latency (p50, p95, p99)
- Resource usage (CPU, memory, network)
- Custom application metrics

**Components**:
- **1 Prometheus Server Pod**
- **ServiceMonitors**: Auto-discovery of metrics endpoints
- **PersistentVolume**: 50GB for metrics retention (15 days)

**Metrics Collected**:
```
# HTTP Requests
istio_requests_total{destination_service="order-service"}

# Request Duration
istio_request_duration_milliseconds_bucket{destination_service="order-service"}

# Error Rate
sum(rate(istio_requests_total{response_code=~"5.*"}[5m]))

# Pod CPU/Memory
container_cpu_usage_seconds_total
container_memory_working_set_bytes

# Custom Application Metrics
restaurant_orders_total
restaurant_revenue_total
restaurant_table_occupancy
```

---

### 2. Grafana (Visualization)

**Purpose**: Dashboards and visualization

**Pre-built Dashboards**:
1. **Istio Service Dashboard**: Service-level metrics
2. **Istio Mesh Dashboard**: Overall mesh health
3. **Istio Performance Dashboard**: Latency and throughput
4. **Istio Workload Dashboard**: Pod-level metrics
5. **Custom Restaurant Dashboard**: Business metrics

**Components**:
- **1 Grafana Pod**
- **LoadBalancer Service** for external access
- **ConfigMaps**: Dashboard definitions
- **Secrets**: Data source configurations

**Sample Dashboard Layout**:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    GRAFANA DASHBOARD                             â”‚
â”‚                 Restaurant Management System                     â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Total Orders   â”‚  â”‚   Revenue       â”‚  â”‚  Active Users   â”‚ â”‚
â”‚  â”‚     1,247       â”‚  â”‚   $12,450       â”‚  â”‚      342        â”‚ â”‚
â”‚  â”‚  â†‘ 15% (24h)   â”‚  â”‚  â†‘ 22% (24h)   â”‚  â”‚  â†‘ 8% (24h)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Request Rate (RPS)                            â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚   300 â”¤                                â•­â•®                  â”‚  â”‚
â”‚  â”‚       â”‚                            â•­â”€â”€â”€â•¯â•°â”€â•®                â”‚  â”‚
â”‚  â”‚   200 â”¤                      â•­â”€â”€â”€â”€â”€â•¯      â•°â”€â”€â”€â•®            â”‚  â”‚
â”‚  â”‚       â”‚                â•­â”€â”€â”€â”€â”€â•¯                 â•°â”€â”€â•®         â”‚  â”‚
â”‚  â”‚   100 â”¤          â•­â”€â”€â”€â”€â”€â•¯                          â•°â”€â”€â”€â•®    â”‚  â”‚
â”‚  â”‚       â”‚    â•­â”€â”€â”€â”€â”€â•¯                                    â•°â”€â”€  â”‚  â”‚
â”‚  â”‚     0 â”¼â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
â”‚  â”‚        0h   4h    8h   12h   16h   20h   24h              â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              Response Time (P95)                           â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚   200ms â”¤                                                  â”‚  â”‚
â”‚  â”‚         â”‚      â—                                           â”‚  â”‚
â”‚  â”‚   150ms â”¤    â—   â—     â—                                  â”‚  â”‚
â”‚  â”‚         â”‚  â—       â—       â—   â—                          â”‚  â”‚
â”‚  â”‚   100ms â”¤â—           â—       â—   â—   â—   â—   â—   â—   â—   â”‚  â”‚
â”‚  â”‚         â”‚                                                  â”‚  â”‚
â”‚  â”‚    50ms â”¤                                                  â”‚  â”‚
â”‚  â”‚      0  â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚  â”‚
â”‚  â”‚          api   order  rest  menu  auth  notif  frontend   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                 Error Rate by Service                      â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  Service              Errors    Rate     Trend             â”‚  â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€   â”‚  â”‚
â”‚  â”‚  api-gateway           12      0.05%    ğŸŸ¢ Stable         â”‚  â”‚
â”‚  â”‚  order-service         18      0.10%    ğŸŸ¢ Stable         â”‚  â”‚
â”‚  â”‚  restaurant-service     3      0.02%    ğŸŸ¢ Stable         â”‚  â”‚
â”‚  â”‚  menu-service           2      0.01%    ğŸŸ¢ Stable         â”‚  â”‚
â”‚  â”‚  auth-service          40      0.50%    ğŸŸ¡ Elevated       â”‚  â”‚
â”‚  â”‚  notification-service   5      0.15%    ğŸŸ¢ Stable         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3. Loki (Logs)

**Purpose**: Log aggregation and querying

**What it collects**:
- Application logs (stdout/stderr)
- Envoy access logs
- Istio control plane logs
- Container logs

**Components**:
- **1 Loki Pod**: Log storage and query engine
- **Promtail DaemonSet**: Log shipping agent (1 pod per node)
- **PersistentVolume**: 100GB for log retention (7 days)

**Log Structure**:
```json
{
  "timestamp": "2025-12-30T10:15:32.123Z",
  "level": "INFO",
  "service": "order-service",
  "pod": "order-service-5f8d9c7b6-xk2j4",
  "namespace": "restaurant-management",
  "message": "Order placed successfully",
  "order_id": "5ccf36a3-c497-4ce5-b42e-5ec845745022",
  "customer_name": "John Doe",
  "total": 45.99,
  "trace_id": "8e8d5a1b2c3d4e5f6a7b8c9d0e1f2a3b"
}
```

**LogQL Queries**:
```logql
# All errors in last hour
{namespace="restaurant-management"} |= "ERROR" | json

# Order service logs
{app="order-service"} | json

# Failed order attempts
{namespace="restaurant-management"}
  |= "order"
  |= "failed"
  | json
  | line_format "{{.timestamp}} {{.message}}"

# Slow queries (>1s)
{app="order-service"}
  | json
  | duration > 1s
```

---

### 4. Jaeger (Distributed Tracing)

**Purpose**: End-to-end request tracing

**What it traces**:
- Request path through microservices
- Latency breakdown per service
- Error propagation
- Dependencies between services

**Components**:
- **1 Jaeger All-in-One Pod** (dev/staging)
- **Production**: Separate collector, query, agent (3 pods)
- **PersistentVolume**: 20GB for trace retention (2 days)

**Trace Example**:
```
Trace ID: 8e8d5a1b2c3d4e5f6a7b8c9d0e1f2a3b
Total Duration: 245ms

â”Œâ”€ frontend (245ms) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GET /order                                                     â”‚
â”‚  â”Œâ”€ api-gateway (220ms) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  POST /api/v1/orders                                       â”‚â”‚
â”‚  â”‚  â”Œâ”€ order-service (180ms) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚â”‚
â”‚  â”‚  â”‚  create_order()                                     â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€ restaurant-service (25ms) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚  GET /restaurants/{id}               â”‚          â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚  validate_restaurant()               â”‚          â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€ menu-service (30ms) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚  GET /menu-items                      â”‚         â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚  validate_items_availability()        â”‚         â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€ postgresql (85ms) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚  INSERT INTO orders                        â”‚    â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚  INSERT INTO order_items                   â”‚    â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”Œâ”€ redis (15ms) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â”‚  SET order:cache:{id}       â”‚                  â”‚   â”‚â”‚
â”‚  â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚   â”‚â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Spans: 8
Services: 5 (frontend, api-gateway, order-service, restaurant-service, menu-service)
Database Calls: 2 (postgresql, redis)
```

---

## GitHub Actions Integration

### Current Pipeline (Existing)

```yaml
# .github/workflows/ci-cd.yml (Current)
name: CI/CD Pipeline

on:
  push:
    branches: [main, developer]

jobs:
  build:
    - Build Docker images
    - Push to Docker Hub

  deploy:
    - Deploy to Kubernetes via kubectl
```

### Updated Pipeline (With Istio & Observability)

```yaml
# .github/workflows/ci-cd-istio.yml (New)
name: CI/CD Pipeline with Istio

on:
  push:
    branches: [main, developer]
  pull_request:
    branches: [main]

env:
  DOCKER_REGISTRY: docker.io
  DOCKER_USERNAME: ${{ secrets.DOCKER_USERNAME }}
  HELM_VERSION: v3.13.0
  ISTIO_VERSION: 1.20.1

jobs:
  build:
    name: Build and Push Images
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKER_USERNAME }}
          password: ${{ secrets.DOCKER_PASSWORD }}

      - name: Build and push images
        run: |
          # Build all service images
          docker build -t $DOCKER_REGISTRY/$DOCKER_USERNAME/api-gateway:${{ github.sha }} services/api-gateway
          docker build -t $DOCKER_REGISTRY/$DOCKER_USERNAME/order-service:${{ github.sha }} services/order-service
          docker build -t $DOCKER_REGISTRY/$DOCKER_USERNAME/restaurant-service:${{ github.sha }} services/restaurant-service
          # ... other services

          # Push images
          docker push $DOCKER_REGISTRY/$DOCKER_USERNAME/api-gateway:${{ github.sha }}
          docker push $DOCKER_REGISTRY/$DOCKER_USERNAME/order-service:${{ github.sha }}
          # ... other services

  deploy-infra:
    name: Deploy Infrastructure (Istio + Observability)
    runs-on: ubuntu-latest
    needs: build
    if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/developer'
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Configure kubectl
        uses: azure/k8s-set-context@v3
        with:
          kubeconfig: ${{ secrets.KUBECONFIG }}

      - name: Install Helm
        uses: azure/setup-helm@v3
        with:
          version: ${{ env.HELM_VERSION }}

      - name: Install Istio
        run: |
          # Download Istio
          curl -L https://istio.io/downloadIstio | ISTIO_VERSION=${{ env.ISTIO_VERSION }} sh -
          cd istio-${{ env.ISTIO_VERSION }}

          # Install Istio with minimal profile (customized)
          ./bin/istioctl install -f infrastructure/istio/istio-config.yaml -y

          # Verify installation
          kubectl get pods -n istio-system
          kubectl wait --for=condition=ready pod -l app=istiod -n istio-system --timeout=300s

      - name: Deploy Observability Stack
        run: |
          # Add Helm repositories
          helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
          helm repo add grafana https://grafana.github.io/helm-charts
          helm repo add jaegertracing https://jaegertracing.github.io/helm-charts
          helm repo update

          # Install Prometheus
          helm upgrade --install prometheus prometheus-community/prometheus \
            -f infrastructure/helm/prometheus-values.yaml \
            -n istio-system --create-namespace

          # Install Grafana
          helm upgrade --install grafana grafana/grafana \
            -f infrastructure/helm/grafana-values.yaml \
            -n istio-system

          # Install Loki
          helm upgrade --install loki grafana/loki-stack \
            -f infrastructure/helm/loki-values.yaml \
            -n istio-system

          # Install Jaeger
          helm upgrade --install jaeger jaegertracing/jaeger \
            -f infrastructure/helm/jaeger-values.yaml \
            -n istio-system

          # Install Kiali
          helm upgrade --install kiali-server kiali/kiali-server \
            -f infrastructure/helm/kiali-values.yaml \
            -n istio-system

      - name: Wait for Observability Stack
        run: |
          kubectl wait --for=condition=ready pod -l app=prometheus -n istio-system --timeout=300s
          kubectl wait --for=condition=ready pod -l app.kubernetes.io/name=grafana -n istio-system --timeout=300s
          kubectl wait --for=condition=ready pod -l app=kiali -n istio-system --timeout=300s

  deploy-app:
    name: Deploy Application
    runs-on: ubuntu-latest
    needs: [build, deploy-infra]
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Configure kubectl
        uses: azure/k8s-set-context@v3
        with:
          kubeconfig: ${{ secrets.KUBECONFIG }}

      - name: Enable Istio Injection
        run: |
          kubectl label namespace restaurant-management istio-injection=enabled --overwrite

      - name: Deploy Application via Helm
        run: |
          helm upgrade --install restaurant-app infrastructure/helm/restaurant-app \
            --set image.tag=${{ github.sha }} \
            --set istio.enabled=true \
            --set observability.enabled=true \
            -n restaurant-management --create-namespace

      - name: Apply Istio VirtualServices & DestinationRules
        run: |
          kubectl apply -f infrastructure/istio/virtualservices/ -n restaurant-management
          kubectl apply -f infrastructure/istio/destinationrules/ -n restaurant-management
          kubectl apply -f infrastructure/istio/gateway.yaml -n restaurant-management

      - name: Verify Deployment
        run: |
          kubectl rollout status deployment/api-gateway -n restaurant-management --timeout=300s
          kubectl rollout status deployment/order-service -n restaurant-management --timeout=300s
          kubectl get pods -n restaurant-management

          # Check sidecar injection
          kubectl get pods -n restaurant-management -o jsonpath='{.items[*].spec.containers[*].name}' | grep istio-proxy

  smoke-tests:
    name: Run Smoke Tests
    runs-on: ubuntu-latest
    needs: deploy-app
    steps:
      - name: Health Check
        run: |
          # Get Istio Ingress external IP
          INGRESS_HOST=$(kubectl get svc istio-ingressgateway -n istio-system -o jsonpath='{.status.loadBalancer.ingress[0].ip}')

          # Test endpoints
          curl -f http://$INGRESS_HOST/health || exit 1
          curl -f http://$INGRESS_HOST/api/v1/health || exit 1

      - name: Check Metrics
        run: |
          # Verify Prometheus is scraping metrics
          kubectl port-forward -n istio-system svc/prometheus 9090:9090 &
          sleep 5
          curl -s http://localhost:9090/api/v1/query?query=up | grep '"status":"success"'
```

---

## Helm Chart Structure

```
infrastructure/
â”œâ”€â”€ helm/
â”‚   â”œâ”€â”€ restaurant-app/                    # Main application chart
â”‚   â”‚   â”œâ”€â”€ Chart.yaml
â”‚   â”‚   â”œâ”€â”€ values.yaml                    # Default values
â”‚   â”‚   â”œâ”€â”€ values-dev.yaml                # Dev environment
â”‚   â”‚   â”œâ”€â”€ values-staging.yaml            # Staging environment
â”‚   â”‚   â”œâ”€â”€ values-prod.yaml               # Production environment
â”‚   â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â”‚   â”œâ”€â”€ _helpers.tpl
â”‚   â”‚   â”‚   â”œâ”€â”€ deployment.yaml            # Service deployments
â”‚   â”‚   â”‚   â”œâ”€â”€ service.yaml               # K8s services
â”‚   â”‚   â”‚   â”œâ”€â”€ configmap.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ secret.yaml
â”‚   â”‚   â”‚   â”œâ”€â”€ hpa.yaml                   # Horizontal Pod Autoscaler
â”‚   â”‚   â”‚   â”œâ”€â”€ pdb.yaml                   # Pod Disruption Budget
â”‚   â”‚   â”‚   â””â”€â”€ istio/
â”‚   â”‚   â”‚       â”œâ”€â”€ virtualservice.yaml    # Istio traffic routing
â”‚   â”‚   â”‚       â”œâ”€â”€ destinationrule.yaml   # Load balancing, circuit breaking
â”‚   â”‚   â”‚       â”œâ”€â”€ gateway.yaml           # Ingress gateway
â”‚   â”‚   â”‚       â”œâ”€â”€ peerauthentication.yaml # mTLS config
â”‚   â”‚   â”‚       â””â”€â”€ authorizationpolicy.yaml # Access control
â”‚   â”‚   â””â”€â”€ charts/                        # Sub-charts (if any)
â”‚   â”‚
â”‚   â”œâ”€â”€ prometheus-values.yaml             # Prometheus configuration
â”‚   â”œâ”€â”€ grafana-values.yaml                # Grafana configuration
â”‚   â”œâ”€â”€ loki-values.yaml                   # Loki configuration
â”‚   â”œâ”€â”€ jaeger-values.yaml                 # Jaeger configuration
â”‚   â””â”€â”€ kiali-values.yaml                  # Kiali configuration
â”‚
â””â”€â”€ istio/
    â”œâ”€â”€ istio-config.yaml                  # Istio installation config
    â”œâ”€â”€ gateway.yaml                       # Main ingress gateway
    â”œâ”€â”€ virtualservices/
    â”‚   â”œâ”€â”€ api-gateway-vs.yaml
    â”‚   â”œâ”€â”€ frontend-vs.yaml
    â”‚   â””â”€â”€ services-vs.yaml
    â”œâ”€â”€ destinationrules/
    â”‚   â”œâ”€â”€ api-gateway-dr.yaml
    â”‚   â”œâ”€â”€ order-service-dr.yaml
    â”‚   â””â”€â”€ services-dr.yaml
    â””â”€â”€ telemetry/
        â”œâ”€â”€ metrics.yaml                   # Custom metrics configuration
        â””â”€â”€ tracing.yaml                   # Tracing configuration
```

---

## Installation Steps

### Prerequisites

```bash
# 1. Kubernetes cluster (1.25+)
kubectl version

# 2. Helm 3.x
helm version

# 3. kubectl configured
kubectl get nodes

# 4. Sufficient cluster resources
# - 3 worker nodes minimum
# - 16 GB RAM per node
# - 50 GB disk space
```

### Step 1: Install Istio

```bash
# Download Istio
curl -L https://istio.io/downloadIstio | ISTIO_VERSION=1.20.1 sh -
cd istio-1.20.1

# Install Istio (customized profile)
./bin/istioctl install -f infrastructure/istio/istio-config.yaml -y

# Verify installation
kubectl get pods -n istio-system

# Expected output:
# NAME                                    READY   STATUS    RESTARTS   AGE
# istiod-5f6b8c7d9-xxxxx                 1/1     Running   0          2m
# istio-ingressgateway-7d8f9b5c-xxxxx    1/1     Running   0          2m
```

### Step 2: Install Observability Stack

```bash
# Add Helm repos
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm repo add grafana https://grafana.github.io/helm-charts
helm repo add jaegertracing https://jaegertracing.github.io/helm-charts
helm repo add kiali https://kiali.org/helm-charts
helm repo update

# Install Prometheus
helm upgrade --install prometheus prometheus-community/prometheus \
  -f infrastructure/helm/prometheus-values.yaml \
  -n istio-system --create-namespace

# Install Grafana
helm upgrade --install grafana grafana/grafana \
  -f infrastructure/helm/grafana-values.yaml \
  -n istio-system

# Install Loki + Promtail
helm upgrade --install loki grafana/loki-stack \
  -f infrastructure/helm/loki-values.yaml \
  -n istio-system

# Install Jaeger
helm upgrade --install jaeger jaegertracing/jaeger \
  -f infrastructure/helm/jaeger-values.yaml \
  -n istio-system

# Install Kiali
helm upgrade --install kiali-server kiali/kiali-server \
  -f infrastructure/helm/kiali-values.yaml \
  -n istio-system

# Verify installations
kubectl get pods -n istio-system
```

### Step 3: Enable Istio Injection for Application Namespace

```bash
# Label namespace for automatic sidecar injection
kubectl create namespace restaurant-management
kubectl label namespace restaurant-management istio-injection=enabled

# Verify label
kubectl get namespace restaurant-management --show-labels
```

### Step 4: Deploy Application

```bash
# Deploy application using Helm
helm upgrade --install restaurant-app infrastructure/helm/restaurant-app \
  --set image.tag=latest \
  --set istio.enabled=true \
  --set observability.enabled=true \
  -n restaurant-management

# Apply Istio Gateway and VirtualServices
kubectl apply -f infrastructure/istio/gateway.yaml -n restaurant-management
kubectl apply -f infrastructure/istio/virtualservices/ -n restaurant-management
kubectl apply -f infrastructure/istio/destinationrules/ -n restaurant-management

# Verify sidecars are injected
kubectl get pods -n restaurant-management

# Each pod should show 2/2 containers (app + envoy sidecar)
```

### Step 5: Access Dashboards

```bash
# Get Istio Ingress Gateway external IP
kubectl get svc istio-ingressgateway -n istio-system

# Access Kiali
kubectl port-forward -n istio-system svc/kiali 20001:20001
# Open: http://localhost:20001

# Access Grafana
kubectl port-forward -n istio-system svc/grafana 3000:80
# Open: http://localhost:3000
# Default credentials: admin / (get from secret)
kubectl get secret -n istio-system grafana -o jsonpath='{.data.admin-password}' | base64 -d

# Access Prometheus
kubectl port-forward -n istio-system svc/prometheus 9090:9090
# Open: http://localhost:9090

# Access Jaeger
kubectl port-forward -n istio-system svc/jaeger-query 16686:16686
# Open: http://localhost:16686
```

---

## Configuration Details

### Istio Configuration File

**File**: `infrastructure/istio/istio-config.yaml`

```yaml
apiVersion: install.istio.io/v1alpha1
kind: IstioOperator
metadata:
  name: restaurant-istio
spec:
  profile: default

  # Global mesh configuration
  meshConfig:
    # Enable access logging
    accessLogFile: /dev/stdout
    accessLogEncoding: JSON

    # Tracing configuration
    enableTracing: true
    defaultConfig:
      tracing:
        sampling: 100  # 100% sampling for dev/staging, 1% for production
        zipkin:
          address: jaeger-collector.istio-system:9411

    # Metrics configuration
    enablePrometheusMerge: true

  # Control plane configuration
  components:
    pilot:
      k8s:
        resources:
          requests:
            cpu: 500m
            memory: 2Gi
          limits:
            cpu: 1000m
            memory: 4Gi
        hpaSpec:
          minReplicas: 2  # HA mode
          maxReplicas: 5

    # Ingress gateway
    ingressGateways:
      - name: istio-ingressgateway
        enabled: true
        k8s:
          service:
            type: LoadBalancer
            ports:
              - port: 80
                targetPort: 8080
                name: http2
              - port: 443
                targetPort: 8443
                name: https
          resources:
            requests:
              cpu: 100m
              memory: 128Mi
            limits:
              cpu: 2000m
              memory: 1Gi
          hpaSpec:
            minReplicas: 2
            maxReplicas: 5
            metrics:
              - type: Resource
                resource:
                  name: cpu
                  targetAverageUtilization: 80

    # Egress gateway (disabled for now)
    egressGateways:
      - name: istio-egressgateway
        enabled: false

  # Values overrides
  values:
    global:
      # mTLS configuration
      mtls:
        enabled: true

      # Proxy configuration (for all sidecars)
      proxy:
        resources:
          requests:
            cpu: 10m
            memory: 40Mi
          limits:
            cpu: 2000m
            memory: 1Gi

        # Access log format
        accessLogFormat: |
          [%START_TIME%] "%REQ(:METHOD)% %REQ(X-ENVOY-ORIGINAL-PATH?:PATH)% %PROTOCOL%" %RESPONSE_CODE% %RESPONSE_FLAGS% %BYTES_RECEIVED% %BYTES_SENT% %DURATION% %RESP(X-ENVOY-UPSTREAM-SERVICE-TIME)% "%REQ(X-FORWARDED-FOR)%" "%REQ(USER-AGENT)%" "%REQ(X-REQUEST-ID)%" "%REQ(:AUTHORITY)%" "%UPSTREAM_HOST%"

    # Telemetry
    telemetry:
      enabled: true
      v2:
        enabled: true
        prometheus:
          enabled: true
```

### Gateway Configuration

**File**: `infrastructure/istio/gateway.yaml`

```yaml
apiVersion: networking.istio.io/v1beta1
kind: Gateway
metadata:
  name: restaurant-gateway
  namespace: restaurant-management
spec:
  selector:
    istio: ingressgateway
  servers:
    # HTTP traffic
    - port:
        number: 80
        name: http
        protocol: HTTP
      hosts:
        - "restaurant.corpv3.com"
        - "*.restaurant.corpv3.com"
      # Redirect to HTTPS (optional)
      # tls:
      #   httpsRedirect: true

    # HTTPS traffic (when SSL is configured)
    # - port:
    #     number: 443
    #     name: https
    #     protocol: HTTPS
    #   hosts:
    #     - "restaurant.corpv3.com"
    #     - "*.restaurant.corpv3.com"
    #   tls:
    #     mode: SIMPLE
    #     credentialName: restaurant-tls-cert
```

### VirtualService Examples

**File**: `infrastructure/istio/virtualservices/api-gateway-vs.yaml`

```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: api-gateway
  namespace: restaurant-management
spec:
  hosts:
    - "restaurant.corpv3.com"
  gateways:
    - restaurant-gateway
  http:
    # API routes
    - match:
        - uri:
            prefix: "/api/v1/"
      route:
        - destination:
            host: api-gateway
            port:
              number: 8000
          weight: 100
      timeout: 30s
      retries:
        attempts: 3
        perTryTimeout: 10s
        retryOn: "5xx,reset,connect-failure,refused-stream"

    # Frontend routes
    - match:
        - uri:
            prefix: "/"
      route:
        - destination:
            host: frontend
            port:
              number: 80
          weight: 100
```

**File**: `infrastructure/istio/virtualservices/order-service-vs.yaml`

```yaml
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: order-service
  namespace: restaurant-management
spec:
  hosts:
    - order-service
  http:
    - route:
        - destination:
            host: order-service
            port:
              number: 8001
            subset: v1  # Canary deployment support
          weight: 90
        - destination:
            host: order-service
            port:
              number: 8001
            subset: v2
          weight: 10
      timeout: 15s
      retries:
        attempts: 3
        perTryTimeout: 5s
```

### DestinationRule Examples

**File**: `infrastructure/istio/destinationrules/order-service-dr.yaml`

```yaml
apiVersion: networking.istio.io/v1beta1
kind: DestinationRule
metadata:
  name: order-service
  namespace: restaurant-management
spec:
  host: order-service

  # Traffic policy
  trafficPolicy:
    # Load balancing
    loadBalancer:
      simple: LEAST_REQUEST  # or ROUND_ROBIN, RANDOM

    # Connection pool
    connectionPool:
      tcp:
        maxConnections: 100
      http:
        http1MaxPendingRequests: 50
        http2MaxRequests: 100
        maxRequestsPerConnection: 2

    # Outlier detection (circuit breaking)
    outlierDetection:
      consecutiveErrors: 5
      interval: 30s
      baseEjectionTime: 30s
      maxEjectionPercent: 50
      minHealthPercent: 50

  # Subsets for canary deployments
  subsets:
    - name: v1
      labels:
        version: v1
    - name: v2
      labels:
        version: v2
```

### PeerAuthentication (mTLS)

**File**: `infrastructure/istio/peerauthentication.yaml`

```yaml
apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: default
  namespace: restaurant-management
spec:
  mtls:
    mode: STRICT  # Enforce mTLS for all services
```

---

## Helm Values Files

### Prometheus Values

**File**: `infrastructure/helm/prometheus-values.yaml`

```yaml
server:
  persistentVolume:
    enabled: true
    size: 50Gi
    storageClass: "standard"

  retention: "15d"

  resources:
    requests:
      cpu: 500m
      memory: 2Gi
    limits:
      cpu: 2000m
      memory: 4Gi

  global:
    scrape_interval: 15s
    evaluation_interval: 15s

alertmanager:
  enabled: true
  persistentVolume:
    enabled: true
    size: 10Gi

nodeExporter:
  enabled: true

pushgateway:
  enabled: false

# Scrape configs for Istio
serverFiles:
  prometheus.yml:
    scrape_configs:
      - job_name: 'kubernetes-pods'
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_scrape]
            action: keep
            regex: true
          - source_labels: [__meta_kubernetes_pod_annotation_prometheus_io_path]
            action: replace
            target_label: __metrics_path__
            regex: (.+)
          - source_labels: [__address__, __meta_kubernetes_pod_annotation_prometheus_io_port]
            action: replace
            regex: ([^:]+)(?::\d+)?;(\d+)
            replacement: $1:$2
            target_label: __address__

      - job_name: 'istio-mesh'
        kubernetes_sd_configs:
          - role: endpoints
            namespaces:
              names:
                - istio-system
                - restaurant-management
        relabel_configs:
          - source_labels: [__meta_kubernetes_service_name, __meta_kubernetes_endpoint_port_name]
            action: keep
            regex: istio-telemetry;prometheus

      - job_name: 'envoy-stats'
        metrics_path: /stats/prometheus
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_container_port_name]
            action: keep
            regex: '.*-envoy-prom'
```

### Grafana Values

**File**: `infrastructure/helm/grafana-values.yaml`

```yaml
persistence:
  enabled: true
  size: 10Gi
  storageClassName: "standard"

adminPassword: "changeme123"  # Change in production

service:
  type: LoadBalancer
  port: 80

resources:
  requests:
    cpu: 100m
    memory: 256Mi
  limits:
    cpu: 500m
    memory: 512Mi

# Data sources
datasources:
  datasources.yaml:
    apiVersion: 1
    datasources:
      - name: Prometheus
        type: prometheus
        url: http://prometheus-server.istio-system:80
        access: proxy
        isDefault: true

      - name: Loki
        type: loki
        url: http://loki.istio-system:3100
        access: proxy

      - name: Jaeger
        type: jaeger
        url: http://jaeger-query.istio-system:16686
        access: proxy

# Dashboard providers
dashboardProviders:
  dashboardproviders.yaml:
    apiVersion: 1
    providers:
      - name: 'istio'
        orgId: 1
        folder: 'Istio'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/istio

      - name: 'restaurant'
        orgId: 1
        folder: 'Restaurant'
        type: file
        disableDeletion: false
        editable: true
        options:
          path: /var/lib/grafana/dashboards/restaurant

# Pre-configured dashboards
dashboards:
  istio:
    istio-mesh:
      gnetId: 7639
      revision: 144
      datasource: Prometheus
    istio-service:
      gnetId: 7636
      revision: 144
      datasource: Prometheus
    istio-workload:
      gnetId: 7630
      revision: 144
      datasource: Prometheus
    istio-performance:
      gnetId: 11829
      revision: 144
      datasource: Prometheus

plugins:
  - grafana-piechart-panel
  - grafana-clock-panel
```

### Loki Values

**File**: `infrastructure/helm/loki-values.yaml`

```yaml
loki:
  enabled: true
  persistence:
    enabled: true
    size: 100Gi
    storageClassName: "standard"

  config:
    auth_enabled: false

    ingester:
      chunk_idle_period: 3m
      chunk_block_size: 262144
      chunk_retain_period: 1m
      max_transfer_retries: 0
      lifecycler:
        ring:
          kvstore:
            store: inmemory
          replication_factor: 1

    limits_config:
      enforce_metric_name: false
      reject_old_samples: true
      reject_old_samples_max_age: 168h

    schema_config:
      configs:
        - from: 2020-10-24
          store: boltdb-shipper
          object_store: filesystem
          schema: v11
          index:
            prefix: index_
            period: 24h

    server:
      http_listen_port: 3100

    storage_config:
      boltdb_shipper:
        active_index_directory: /data/loki/boltdb-shipper-active
        cache_location: /data/loki/boltdb-shipper-cache
        cache_ttl: 24h
        shared_store: filesystem
      filesystem:
        directory: /data/loki/chunks

    chunk_store_config:
      max_look_back_period: 168h  # 7 days retention

    table_manager:
      retention_deletes_enabled: true
      retention_period: 168h

promtail:
  enabled: true
  config:
    clients:
      - url: http://loki:3100/loki/api/v1/push

    scrape_configs:
      # Kubernetes pod logs
      - job_name: kubernetes-pods
        kubernetes_sd_configs:
          - role: pod
        relabel_configs:
          - source_labels: [__meta_kubernetes_pod_node_name]
            target_label: node
          - source_labels: [__meta_kubernetes_namespace]
            target_label: namespace
          - source_labels: [__meta_kubernetes_pod_name]
            target_label: pod
          - source_labels: [__meta_kubernetes_pod_container_name]
            target_label: container
        pipeline_stages:
          - docker: {}
          - json:
              expressions:
                level: level
                timestamp: timestamp
                message: message
          - labels:
              level:
              namespace:
              pod:
              container:
```

### Jaeger Values

**File**: `infrastructure/helm/jaeger-values.yaml`

```yaml
provisionDataStore:
  cassandra: false
  elasticsearch: false

allInOne:
  enabled: true

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

storage:
  type: badger
  badger:
    ephemeral: false
    persistence:
      enabled: true
      size: 20Gi
      storageClass: "standard"

query:
  enabled: false  # Using all-in-one

collector:
  enabled: false  # Using all-in-one

agent:
  enabled: false  # Using all-in-one

# Ingress for Jaeger UI
ingress:
  enabled: false  # Access via port-forward or LoadBalancer
```

### Kiali Values

**File**: `infrastructure/helm/kiali-values.yaml`

```yaml
auth:
  strategy: "anonymous"  # For dev/staging. Use "token" or "openid" for prod

deployment:
  accessible_namespaces:
    - "**"  # Monitor all namespaces

  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: 500m
      memory: 512Mi

external_services:
  custom_dashboards:
    enabled: true

  prometheus:
    url: "http://prometheus-server.istio-system:80"

  grafana:
    enabled: true
    in_cluster_url: "http://grafana.istio-system:80"
    url: "http://grafana.istio-system:80"

  tracing:
    enabled: true
    in_cluster_url: "http://jaeger-query.istio-system:16686"
    url: "http://jaeger-query.istio-system:16686"
    use_grpc: false

server:
  web_root: "/kiali"
  web_port: 20001

# Service configuration
service:
  type: LoadBalancer
  port: 20001
```

---

## Monitoring & Alerting

### Key Metrics to Monitor

#### 1. **Golden Signals (RED Metrics)**

```promql
# Request Rate (Requests per second)
sum(rate(istio_requests_total{destination_service="order-service"}[5m]))

# Error Rate (Percentage of failed requests)
sum(rate(istio_requests_total{destination_service="order-service",response_code=~"5.*"}[5m]))
/
sum(rate(istio_requests_total{destination_service="order-service"}[5m])) * 100

# Duration (Response time P95)
histogram_quantile(0.95,
  sum(rate(istio_request_duration_milliseconds_bucket{destination_service="order-service"}[5m])) by (le)
)
```

#### 2. **Service Health**

```promql
# Pod availability
count(up{job="kubernetes-pods",namespace="restaurant-management"} == 1)
/
count(up{job="kubernetes-pods",namespace="restaurant-management"})

# CPU usage
sum(rate(container_cpu_usage_seconds_total{namespace="restaurant-management"}[5m])) by (pod)

# Memory usage
sum(container_memory_working_set_bytes{namespace="restaurant-management"}) by (pod)
```

#### 3. **Business Metrics**

```promql
# Total orders
sum(increase(restaurant_orders_total[1h]))

# Order success rate
sum(increase(restaurant_orders_total{status="completed"}[1h]))
/
sum(increase(restaurant_orders_total[1h])) * 100

# Revenue
sum(increase(restaurant_revenue_total[1h]))

# Active tables
restaurant_table_occupancy
```

### Alert Rules

**File**: `infrastructure/helm/prometheus-alert-rules.yaml`

```yaml
apiVersion: v1
kind: ConfigMap
metadata:
  name: prometheus-alert-rules
  namespace: istio-system
data:
  alert-rules.yml: |
    groups:
      - name: restaurant_alerts
        interval: 30s
        rules:
          # High error rate
          - alert: HighErrorRate
            expr: |
              sum(rate(istio_requests_total{response_code=~"5.*"}[5m])) by (destination_service)
              /
              sum(rate(istio_requests_total[5m])) by (destination_service)
              > 0.05
            for: 5m
            labels:
              severity: critical
            annotations:
              summary: "High error rate detected"
              description: "{{ $labels.destination_service }} has error rate above 5% (current: {{ $value | humanizePercentage }})"

          # High latency
          - alert: HighLatency
            expr: |
              histogram_quantile(0.95,
                sum(rate(istio_request_duration_milliseconds_bucket[5m])) by (le, destination_service)
              ) > 1000
            for: 5m
            labels:
              severity: warning
            annotations:
              summary: "High latency detected"
              description: "{{ $labels.destination_service }} P95 latency is above 1000ms (current: {{ $value }}ms)"

          # Pod down
          - alert: PodDown
            expr: |
              kube_deployment_status_replicas_available{namespace="restaurant-management"}
              <
              kube_deployment_spec_replicas{namespace="restaurant-management"}
            for: 5m
            labels:
              severity: critical
            annotations:
              summary: "Pod is down"
              description: "{{ $labels.deployment }} has fewer pods than expected"

          # High CPU
          - alert: HighCPUUsage
            expr: |
              sum(rate(container_cpu_usage_seconds_total{namespace="restaurant-management"}[5m])) by (pod)
              /
              sum(container_spec_cpu_quota{namespace="restaurant-management"} / container_spec_cpu_period{namespace="restaurant-management"}) by (pod)
              > 0.8
            for: 10m
            labels:
              severity: warning
            annotations:
              summary: "High CPU usage"
              description: "{{ $labels.pod }} is using more than 80% CPU"

          # High memory
          - alert: HighMemoryUsage
            expr: |
              sum(container_memory_working_set_bytes{namespace="restaurant-management"}) by (pod)
              /
              sum(container_spec_memory_limit_bytes{namespace="restaurant-management"}) by (pod)
              > 0.8
            for: 10m
            labels:
              severity: warning
            annotations:
              summary: "High memory usage"
              description: "{{ $labels.pod }} is using more than 80% memory"
```

---

## Cost Analysis

### Additional Pods Required

| Component | Replicas | CPU (per pod) | Memory (per pod) | Total CPU | Total Memory |
|-----------|----------|---------------|------------------|-----------|--------------|
| **Istio Control Plane** |
| istiod | 2 | 500m | 2Gi | 1000m | 4Gi |
| **Istio Data Plane (Sidecars)** |
| Envoy sidecars | ~16 | 10m | 40Mi | 160m | 640Mi |
| **Istio Ingress** |
| istio-ingressgateway | 2 | 100m | 128Mi | 200m | 256Mi |
| **Observability** |
| Prometheus | 1 | 500m | 2Gi | 500m | 2Gi |
| Grafana | 1 | 100m | 256Mi | 100m | 256Mi |
| Loki | 1 | 200m | 512Mi | 200m | 512Mi |
| Promtail (DaemonSet) | 3 | 50m | 128Mi | 150m | 384Mi |
| Jaeger | 1 | 100m | 256Mi | 100m | 256Mi |
| Kiali | 1 | 100m | 256Mi | 100m | 256Mi |
| **TOTAL** | **28** | | | **2.51 cores** | **8.6 GB** |

### Storage Requirements

| Component | Size | Retention | Type |
|-----------|------|-----------|------|
| Prometheus | 50GB | 15 days | Metrics |
| Loki | 100GB | 7 days | Logs |
| Jaeger | 20GB | 2 days | Traces |
| Grafana | 10GB | Persistent | Dashboards |
| **TOTAL** | **180GB** | | |

### Cost Estimate (AWS EKS Example)

**Compute Costs**:
- Additional CPU: 2.5 cores Ã— $0.0416/hour = $0.104/hour = **$75/month**
- Additional Memory: 8.6 GB Ã— $0.0046/hour = $0.039/hour = **$28/month**

**Storage Costs**:
- EBS volumes: 180GB Ã— $0.10/GB/month = **$18/month**

**Load Balancer**:
- Istio Ingress Gateway: **$16/month** (AWS NLB)
- Grafana/Kiali LB: **$16/month** (optional, can use port-forward)

**Total Additional Cost**: **$121-153/month**

### Cost Optimization Options

1. **Reduce sidecar resources** (10m CPU â†’ 5m CPU): Save ~$30/month
2. **Use single Istio control plane replica** (non-HA): Save ~$30/month
3. **Reduce metrics retention** (15 days â†’ 7 days): Save storage costs
4. **Use NodePort instead of LoadBalancer for dashboards**: Save $16/month
5. **Reduce trace sampling** (100% â†’ 1%): Reduce storage and processing

**Optimized Cost**: **$75-90/month**

---

## Summary

### Benefits

âœ… **Traffic Management**: Canary deployments, A/B testing, circuit breaking
âœ… **Security**: Automatic mTLS encryption between services
âœ… **Observability**: Complete visibility into service behavior
âœ… **Reliability**: Automatic retries, timeouts, health checks
âœ… **Performance**: Load balancing, connection pooling
âœ… **Debugging**: Distributed tracing shows exact request flow
âœ… **Compliance**: Network policies and audit logs

### Trade-offs

âš ï¸ **Complexity**: Additional learning curve for Istio concepts
âš ï¸ **Resources**: ~2.5 CPU cores and 8.6 GB RAM overhead
âš ï¸ **Latency**: ~1-5ms added latency per hop (due to Envoy proxies)
âš ï¸ **Cost**: $121-153/month additional infrastructure cost
âš ï¸ **Debugging**: More components to troubleshoot when issues occur

### Recommendation

**For Production**: Implement Istio + full observability stack
**For Staging**: Implement with reduced resources
**For Development**: Skip service mesh, use basic monitoring only

---

## Next Steps

1. **Phase 1: Istio Installation** (Week 1)
   - Install Istio control plane
   - Enable sidecar injection
   - Test basic traffic routing

2. **Phase 2: Observability Stack** (Week 2)
   - Deploy Prometheus, Grafana, Loki, Jaeger, Kiali
   - Configure dashboards
   - Set up alerts

3. **Phase 3: Application Migration** (Week 3)
   - Deploy services with sidecars
   - Configure VirtualServices and DestinationRules
   - Test mTLS and traffic management

4. **Phase 4: GitHub Actions Integration** (Week 4)
   - Update CI/CD pipeline
   - Add Helm deployment steps
   - Implement canary deployment workflow

5. **Phase 5: Monitoring & Tuning** (Ongoing)
   - Monitor metrics and alerts
   - Optimize resource allocation
   - Fine-tune traffic policies

---

**Document Version**: 1.0
**Last Updated**: 2025-12-30
**Author**: Claude (AI Assistant)
**Status**: Ready for Implementation
